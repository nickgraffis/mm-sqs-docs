import{_ as a}from"./Post.3c6da465.js";import{q as l,o as n,k as b,w as r,a as e,z as s}from"./vendor.09be1bf3.js";import"./app.3d6c68a9.js";const j=e("div",{class:"prose prose-sm text-left max-w-3xl mx-auto"},[e("h1",{id:"understanding-simple-queue-service",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#understanding-simple-queue-service","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Understanding Simple Queue Service"),s(" Understanding Simple Queue Service ")])]),e("h2",{id:"queue-configuration",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#queue-configuration","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Queue Configuration"),s(" Queue Configuration ")])]),e("h3",{id:"visibility-timeout",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#visibility-timeout","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Visibility Timeout"),s(" Visibility Timeout ")])]),e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Visibility timeout is an extreamly important pramater. It needs to always be greater than the function timeout to avoid duplicate invokes, and for low-concurrency, high-duration functions; we should set visibility timoeut to 6x funciton duration; this will avoid having that receive count move up unnecessarily and keep good messages out of the dead letter queue."),s(" Visibility timeout is an extreamly important pramater. It needs to always be greater than the function timeout to avoid duplicate invokes, and for low-concurrency, high-duration functions; we should set visibility timoeut to 6x funciton duration; this will avoid having that receive count move up unnecessarily and keep good messages out of the dead letter queue. ")])]),e("div",{style:{position:"relative"}},[e("pre",{class:"shiki dracula",style:{"background-color":"#282A36",color:"#F8F8F2"}},[e("div",{class:"language-id"},"yaml"),e("code",{class:"code-container"},[e("div",{class:"line"},[e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"VisibilityTimeout"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#BD93F9"},class:"[object Object]"},"60")])])]),e("button",{class:"markdown-it-code-copy","data-clipboard-text":`
	VisibilityTimeout: 60
`,style:{position:"absolute",top:"7.5px",right:"6px",cursor:"pointer",outline:"none"},title:"Copy"},[e("span",{style:{},class:"heroicon heroicon-duplicate"})])]),e("h3",{id:"enable-a-redrive-policy",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#enable-a-redrive-policy","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Enable a Redrive Policy"),s(" Enable a Redrive Policy ")])]),e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"It is extreamly important to enable a redrive policy to catch any messages that are "),s(" It is extreamly important to enable a redrive policy to catch any messages that are ")]),e("em",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"poisen"),s(" poisen ")])]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},", meaning that they are causing a failure in the function. The "),s(" , meaning that they are causing a failure in the function. The ")]),e("code",null,"maxReceiveCount"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," is the number of times a message will be retried before being moved to the dead letter queue. The "),s(" is the number of times a message will be retried before being moved to the dead letter queue. The ")]),e("code",null,"deadLetterTargetArn"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," is the ARN of the queue that will receive the message."),s(" is the ARN of the queue that will receive the message. ")])]),e("div",{style:{position:"relative"}},[e("pre",{class:"shiki dracula",style:{"background-color":"#282A36",color:"#F8F8F2"}},[e("div",{class:"language-id"},"yaml"),e("code",{class:"code-container"},[e("div",{class:"line"},[e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"RedrivePolicy"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"deadLetterTargetArn"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"    "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Fn::GetAtt"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"}," ["),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"mmDeadLetterQueue"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},", "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"Arn"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"]")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"maxReceiveCount"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#BD93F9"},class:"[object Object]"},"2")])])]),e("button",{class:"markdown-it-code-copy","data-clipboard-text":`
	RedrivePolicy:
  deadLetterTargetArn:
    Fn::GetAtt: [mmDeadLetterQueue, Arn]
  maxReceiveCount: 2
`,style:{position:"absolute",top:"7.5px",right:"6px",cursor:"pointer",outline:"none"},title:"Copy"},[e("span",{style:{},class:"heroicon heroicon-duplicate"})])]),e("h2",{id:"function-configuration",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#function-configuration","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Function Configuration"),s(" Function Configuration ")])]),e("h3",{id:"batching",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#batching","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Batching"),s(" Batching ")])]),e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"It is imporant to enable batching on the lambda that the queue will invoke. This will allow the queue to batch up messages and invoke the function in a single request. The "),s(" It is imporant to enable batching on the lambda that the queue will invoke. This will allow the queue to batch up messages and invoke the function in a single request. The ")]),e("code",null,"BatchSize"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," is the number of batches of messages that will be processed at once, and the "),s(" is the number of batches of messages that will be processed at once, and the ")]),e("code",null,"MaximumBathchingWindowInSeconds"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," is the maximum amount of time that will be spent waiting for new messages to fill the batch before it just begins. This is set to 0 by default."),s(" is the maximum amount of time that will be spent waiting for new messages to fill the batch before it just begins. This is set to 0 by default. ")])]),e("div",{style:{position:"relative"}},[e("pre",{class:"shiki dracula",style:{"background-color":"#282A36",color:"#F8F8F2"}},[e("div",{class:"language-id"},"yaml"),e("code",{class:"code-container"},[e("div",{class:"line"},[e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"BatchSize"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#BD93F9"},class:"[object Object]"},"5")]),e("div",{class:"line"},[e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"MaximumBatchingWindowInSeconds"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#BD93F9"},class:"[object Object]"},"1")])])]),e("button",{class:"markdown-it-code-copy","data-clipboard-text":`
	BatchSize: 5
MaximumBatchingWindowInSeconds: 1
`,style:{position:"absolute",top:"7.5px",right:"6px",cursor:"pointer",outline:"none"},title:"Copy"},[e("span",{style:{},class:"heroicon heroicon-duplicate"})])]),e("h3",{id:"handeling-errors",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#handeling-errors","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Handeling Errors"),s(" Handeling Errors ")])]),e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"We should handle errors and catch these ourselves. This means that if only one message in a batch is "),s(" We should handle errors and catch these ourselves. This means that if only one message in a batch is ")]),e("em",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"posien"),s(" posien ")])]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," then we can manually delete the other messages in that batch that did succeed so they don\u2019t all get retired to the dead letter queue."),s(" then we can manually delete the other messages in that batch that did succeed so they don\u2019t all get retired to the dead letter queue. ")])]),e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"And also, manually set the the per-message visibility timeout to a low number on errors so that the retry process will occur quickly and the message can be sent to the dead letter queue."),s(" And also, manually set the the per-message visibility timeout to a low number on errors so that the retry process will occur quickly and the message can be sent to the dead letter queue. ")])]),e("h2",{id:"what-is-an-sqs-event",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#what-is-an-sqs-event","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"What is an SQS Event"),s(" What is an SQS Event ")])]),e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"The SQS event is a JSON object that contains the details of the event. The top level of this is the "),s(" The SQS event is a JSON object that contains the details of the event. The top level of this is the ")]),e("code",null,"Records"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," array, which contains the details of each message."),s(" array, which contains the details of each message. ")])]),e("div",{style:{position:"relative"}},[e("pre",{class:"shiki dracula",style:{"background-color":"#282A36",color:"#F8F8F2"}},[e("div",{class:"language-id"},"json"),e("code",{class:"code-container"},[e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"{")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"    "),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#8BE9FD"},class:"[object Object]"},"Records"),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"}," [")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"        {")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"            "),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#8BE9FD"},class:"[object Object]"},"messageId"),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"059f36b4-87a3-44ab-83d2-661975830a7d"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"            "),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#8BE9FD"},class:"[object Object]"},"receiptHandle"),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"AQEBwJnKyrHigUMZj6rYigCgxlaS3SLy0a..."),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"            "),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#8BE9FD"},class:"[object Object]"},"body"),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"Test message."),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"            "),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#8BE9FD"},class:"[object Object]"},"attributes"),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"}," {")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"                "),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#8BE9FD"},class:"[object Object]"},"ApproximateReceiveCount"),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"1"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"                "),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#8BE9FD"},class:"[object Object]"},"SentTimestamp"),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"1545082649183"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"                "),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#8BE9FD"},class:"[object Object]"},"SenderId"),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"AIDAIENQZJOLO23YVJ4VO"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"                "),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#8BE9FD"},class:"[object Object]"},"ApproximateFirstReceiveTimestamp"),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"1545082649185"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"')]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"},"            },")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"            "),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#8BE9FD"},class:"[object Object]"},"messageAttributes"),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object]"}," {},")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"            "),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#8BE9FD"},class:"[object Object]"},"md5OfBody"),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"e4e68fb7bd0e697a0ae8f1bb342846b3"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"            "),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#8BE9FD"},class:"[object Object]"},"eventSource"),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"aws:sqs"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"            "),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#8BE9FD"},class:"[object Object]"},"eventSourceARN"),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"arn:aws:sqs:us-east-2:123456789012:my-queue"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"            "),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#8BE9FD"},class:"[object Object]"},"awsRegion"),e("span",{style:{color:"#8BE9FE"},class:"[object Object]"},'"'),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"'),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"us-east-2"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},'"')]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"},"        },")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"    ]")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"}")])])]),e("button",{class:"markdown-it-code-copy","data-clipboard-text":`
	{
    <DOUBLE-QUOTE>Records<DOUBLE-QUOTE>: [
        {
            <DOUBLE-QUOTE>messageId<DOUBLE-QUOTE>: <DOUBLE-QUOTE>059f36b4-87a3-44ab-83d2-661975830a7d<DOUBLE-QUOTE>,
            <DOUBLE-QUOTE>receiptHandle<DOUBLE-QUOTE>: <DOUBLE-QUOTE>AQEBwJnKyrHigUMZj6rYigCgxlaS3SLy0a...<DOUBLE-QUOTE>,
            <DOUBLE-QUOTE>body<DOUBLE-QUOTE>: <DOUBLE-QUOTE>Test message.<DOUBLE-QUOTE>,
            <DOUBLE-QUOTE>attributes<DOUBLE-QUOTE>: {
                <DOUBLE-QUOTE>ApproximateReceiveCount<DOUBLE-QUOTE>: <DOUBLE-QUOTE>1<DOUBLE-QUOTE>,
                <DOUBLE-QUOTE>SentTimestamp<DOUBLE-QUOTE>: <DOUBLE-QUOTE>1545082649183<DOUBLE-QUOTE>,
                <DOUBLE-QUOTE>SenderId<DOUBLE-QUOTE>: <DOUBLE-QUOTE>AIDAIENQZJOLO23YVJ4VO<DOUBLE-QUOTE>,
                <DOUBLE-QUOTE>ApproximateFirstReceiveTimestamp<DOUBLE-QUOTE>: <DOUBLE-QUOTE>1545082649185<DOUBLE-QUOTE>
            },
            <DOUBLE-QUOTE>messageAttributes<DOUBLE-QUOTE>: {},
            <DOUBLE-QUOTE>md5OfBody<DOUBLE-QUOTE>: <DOUBLE-QUOTE>e4e68fb7bd0e697a0ae8f1bb342846b3<DOUBLE-QUOTE>,
            <DOUBLE-QUOTE>eventSource<DOUBLE-QUOTE>: <DOUBLE-QUOTE>aws:sqs<DOUBLE-QUOTE>,
            <DOUBLE-QUOTE>eventSourceARN<DOUBLE-QUOTE>: <DOUBLE-QUOTE>arn:aws:sqs:us-east-2:123456789012:my-queue<DOUBLE-QUOTE>,
            <DOUBLE-QUOTE>awsRegion<DOUBLE-QUOTE>: <DOUBLE-QUOTE>us-east-2<DOUBLE-QUOTE>
        },
    ]
}
`,style:{position:"absolute",top:"7.5px",right:"6px",cursor:"pointer",outline:"none"},title:"Copy"},[e("span",{style:{},class:"heroicon heroicon-duplicate"})])]),e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"When you are handeling batches of messages, you can use the "),s(" When you are handeling batches of messages, you can use the ")]),e("code",null,"Records"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," array to handle each of these messages. You can then also use the "),s(" array to handle each of these messages. You can then also use the ")]),e("code",null,"messageId"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," to delete the message from the queue if it succeeded and, maybe, some message failed."),s(" to delete the message from the queue if it succeeded and, maybe, some message failed. ")])]),e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Lets see an example of how to potentially handle a batch of messages where some fail."),s(" Lets see an example of how to potentially handle a batch of messages where some fail. ")])]),e("div",{style:{position:"relative"}},[e("pre",{class:"shiki dracula",style:{"background-color":"#282A36",color:"#F8F8F2"}},[e("div",{class:"language-id"},"js"),e("code",{class:"code-container"},[e("div",{class:"line"},[e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"const"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"}," SQS "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD"},class:"[object Object]"},"require"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"("),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'"),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"aws-sdk/clients/sqs"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},")")]),e("div",{class:"line"},[e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"const"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"}," sqs "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FF79C6","font-weight":"bold"},class:"[object Object]"},"new"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#50FA7B"},class:"[object Object]"},"SQS"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"()")]),e("div",{class:"line"}),e("div",{class:"line"},[e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"async"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"function"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#50FA7B"},class:"[object Object]"},"handler"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"}," ("),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"event"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"},") {")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"const"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"}," messageProcessingPromises "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object],[object Object]"}," event.Records."),e("span",{style:{color:"#50FA7B"},class:"[object Object]"},"map"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"("),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"async"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"}," ("),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"record"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},", "),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"index"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},") "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"=>"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"}," {")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"      "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"const"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"}," messageResult "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"await"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#50FA7B"},class:"[object Object]"},"processMessage"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"},"(record)")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"      "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"await"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"}," sqs."),e("span",{style:{color:"#50FA7B"},class:"[object Object]"},"deleteMessage"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"({")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"        QueueUrl"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#50FA7B"},class:"[object Object]"},"getQueueUrl"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object]"},"({ sqs, eventSourceARN"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object]"}," record.eventSourceARN })")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object],[object Object],[object Object]"},"        ReceiptHandle: record.receiptHandle")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object]"},"      })."),e("span",{style:{color:"#50FA7B"},class:"[object Object]"},"promise"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"()")]),e("div",{class:"line"}),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"      "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"return"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"}," messageResult")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"},"  })")]),e("div",{class:"line"}),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"const"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"}," processedMessages "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"await"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"Promise"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"."),e("span",{style:{color:"#50FA7B"},class:"[object Object]"},"allSettled"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"},"(messageProcessingPromises)")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"const"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"}," failedMessages "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"}," processedMessages."),e("span",{style:{color:"#50FA7B"},class:"[object Object]"},"filter"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"(("),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"r"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},") "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"=>"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object],[object Object]"}," r.status "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"==="),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'"),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"rejected"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},")")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#6272A4"},class:"[object Object],[object Object]"},"// At least one message failed to be processed; throw an error to keep the failed messages on the queue")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"if"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object]"}," (failedMessages.length) "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"throw"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FF79C6","font-weight":"bold"},class:"[object Object]"},"new"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"Error"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"("),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'"),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"Partial batch failure"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},")")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  ")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#6272A4"},class:"[object Object],[object Object]"},"// All messages were processed successfully")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"return"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#BD93F9"},class:"[object Object]"},"null")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"}")]),e("div",{class:"line"}),e("div",{class:"line"},[e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"async"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"function"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#50FA7B"},class:"[object Object]"},"processMessage"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"("),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"record"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"},") {")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"...")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"}")]),e("div",{class:"line"}),e("div",{class:"line"},[e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"function"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#50FA7B"},class:"[object Object]"},"getQueueUrl"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object]"}," ({ "),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"sqs"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},", "),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"eventSourceARN"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object],[object Object]"}," }) {")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"const"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object]"}," [, , , , accountId, queueName] "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"}," eventSourceARN."),e("span",{style:{color:"#50FA7B"},class:"[object Object]"},"split"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"("),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'"),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},":"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},")")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"return"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"`"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"${"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object],[object Object]"},"sqs.endpoint.href"),e("span",{style:{color:"#FF79C6"},class:"[object Object],[object Object]"},"}${"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"accountId"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"}"),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"/"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"${"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"queueName"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"}"),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"`")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"}")]),e("div",{class:"line"}),e("div",{class:"line"},[e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"module"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"."),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"exports"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"},".handler "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"}," handler")])])]),e("button",{class:"markdown-it-code-copy","data-clipboard-text":`
	const SQS = require(<SINGLE-QUOTE>aws-sdk/clients/sqs<SINGLE-QUOTE>)
const sqs = new SQS()

async function handler (event) {
  const messageProcessingPromises = event.Records.map(async (record, index) => {
      const messageResult = await processMessage(record)
      await sqs.deleteMessage({
        QueueUrl: getQueueUrl({ sqs, eventSourceARN: record.eventSourceARN })
        ReceiptHandle: record.receiptHandle
      }).promise()

      return messageResult
  })

  const processedMessages = await Promise.allSettled(messageProcessingPromises)
  const failedMessages = processedMessages.filter((r) => r.status === <SINGLE-QUOTE>rejected<SINGLE-QUOTE>)
  // At least one message failed to be processed; throw an error to keep the failed messages on the queue
  if (failedMessages.length) throw new Error(<SINGLE-QUOTE>Partial batch failure<SINGLE-QUOTE>)
  
  // All messages were processed successfully
  return null
}

async function processMessage(record) {
  ...
}

function getQueueUrl ({ sqs, eventSourceARN }) {
  const [, , , , accountId, queueName] = eventSourceARN.split(<SINGLE-QUOTE>:<SINGLE-QUOTE>)
  return \`\${sqs.endpoint.href}\${accountId}/\${queueName}\`
}

module.exports.handler = handler
`,style:{position:"absolute",top:"7.5px",right:"6px",cursor:"pointer",outline:"none"},title:"Copy"},[e("span",{style:{},class:"heroicon heroicon-duplicate"})])]),e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"In this example here we are going to process each message and delete that message from the queue. The onces that were rejected, were never deleted. And then when we throw the error, the retry will only effect the messages that have not yet been deleted."),s(" In this example here we are going to process each message and delete that message from the queue. The onces that were rejected, were never deleted. And then when we throw the error, the retry will only effect the messages that have not yet been deleted. ")])]),e("h2",{id:"what-is-a-dead-letter-queue",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#what-is-a-dead-letter-queue","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"What is a Dead Letter Queue"),s(" What is a Dead Letter Queue ")])]),e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"The dead letter queue is a queue that is used to store messages that failed to be processed. This is a queue that is configured to be a dead letter queue."),s(" The dead letter queue is a queue that is used to store messages that failed to be processed. This is a queue that is configured to be a dead letter queue. ")])])],-1),h={setup(i,{expose:c}){const t={duration:"4 min read",content:`Understanding Simple Queue Service
Queue Configuration
Visibility Timeout
Visibility timeout is an extreamly important pramater. It needs to always be greater than the function timeout to avoid duplicate invokes, and for low-concurrency, high-duration functions; we should set visibility timoeut to 6x funciton duration; this will avoid having that receive count move up unnecessarily and keep good messages out of the dead letter queue.
VisibilityTimeout: 60
Enable a Redrive Policy
It is extreamly important to enable a redrive policy to catch any messages that are poisen, meaning that they are causing a failure in the function. The maxReceiveCount is the number of times a message will be retried before being moved to the dead letter queue. The deadLetterTargetArn is the ARN of the queue that will receive the message.
RedrivePolicy:
  deadLetterTargetArn:
    Fn::GetAtt: [mmDeadLetterQueue, Arn]
  maxReceiveCount: 2
Function Configuration
Batching
It is imporant to enable batching on the lambda that the queue will invoke. This will allow the queue to batch up messages and invoke the function in a single request. The BatchSize is the number of batches of messages that will be processed at once, and the MaximumBathchingWindowInSeconds is the maximum amount of time that will be spent waiting for new messages to fill the batch before it just begins. This is set to 0 by default.
BatchSize: 5
MaximumBatchingWindowInSeconds: 1
Handeling Errors
We should handle errors and catch these ourselves. This means that if only one message in a batch is posien then we can manually delete the other messages in that batch that did succeed so they don&amp#39;t all get retired to the dead letter queue.
And also, manually set the the per-message visibility timeout to a low number on errors so that the retry process will occur quickly and the message can be sent to the dead letter queue.
What is an SQS Event
The SQS event is a JSON object that contains the details of the event. The top level of this is the Records array, which contains the details of each message.
{
    &quotRecords&quot: [
        {
            &quotmessageId&quot: &quot059f36b4-87a3-44ab-83d2-661975830a7d&quot,
            &quotreceiptHandle&quot: &quotAQEBwJnKyrHigUMZj6rYigCgxlaS3SLy0a...&quot,
            &quotbody&quot: &quotTest message.&quot,
            &quotattributes&quot: {
                &quotApproximateReceiveCount&quot: &quot1&quot,
                &quotSentTimestamp&quot: &quot1545082649183&quot,
                &quotSenderId&quot: &quotAIDAIENQZJOLO23YVJ4VO&quot,
                &quotApproximateFirstReceiveTimestamp&quot: &quot1545082649185&quot
            },
            &quotmessageAttributes&quot: {},
            &quotmd5OfBody&quot: &quote4e68fb7bd0e697a0ae8f1bb342846b3&quot,
            &quoteventSource&quot: &quotaws:sqs&quot,
            &quoteventSourceARN&quot: &quotarn:aws:sqs:us-east-2:123456789012:my-queue&quot,
            &quotawsRegion&quot: &quotus-east-2&quot
        },
    ]
}
When you are handeling batches of messages, you can use the Records array to handle each of these messages. You can then also use the messageId to delete the message from the queue if it succeeded and, maybe, some message failed. 
Lets see an example of how to potentially handle a batch of messages where some fail.
const SQS = require(&#39aws-sdk/clients/sqs&#39)
const sqs = new SQS()

async function handler (event) {
  const messageProcessingPromises = event.Records.map(async (record, index) =&gt {
      const messageResult = await processMessage(record)
      await sqs.deleteMessage({
        QueueUrl: getQueueUrl({ sqs, eventSourceARN: record.eventSourceARN })
        ReceiptHandle: record.receiptHandle
      }).promise()

      return messageResult
  })

  const processedMessages = await Promise.allSettled(messageProcessingPromises)
  const failedMessages = processedMessages.filter((r) =&gt r.status === &#39rejected&#39)
  // At least one message failed to be processed; throw an error to keep the failed messages on the queue
  if (failedMessages.length) throw new Error(&#39Partial batch failure&#39)

  // All messages were processed successfully
  return null
}

async function processMessage(record) {
  ...
}

function getQueueUrl ({ sqs, eventSourceARN }) {
  const [, , , , accountId, queueName] = eventSourceARN.split(&#39:&#39)
  return \`\${sqs.endpoint.href}\${accountId}/\${queueName}\`
}

module.exports.handler = handler
In this example here we are going to process each message and delete that message from the queue. The onces that were rejected, were never deleted. And then when we throw the error, the retry will only effect the messages that have not yet been deleted.
What is a Dead Letter Queue
The dead letter queue is a queue that is used to store messages that failed to be processed. This is a queue that is configured to be a dead letter queue.
`,meta:[]};return c({frontmatter:t}),l({meta:[]}),(p,O)=>{const o=a;return n(),b(o,{frontmatter:t},{default:r(()=>[j]),_:1})}}};export{h as default};

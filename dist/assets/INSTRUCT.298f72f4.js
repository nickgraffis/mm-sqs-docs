import{_ as l}from"./Post.3c6da465.js";import{q as c,o as n,k as r,w as i,a as e,z as s}from"./vendor.09be1bf3.js";import"./app.3d6c68a9.js";const p=e("div",{class:"prose prose-sm text-left max-w-3xl mx-auto"},[e("h2",{id:"functions-for-queue-system",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#functions-for-queue-system","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Functions for queue system"),s(" Functions for queue system ")])]),e("ul",null,[e("li",null,[e("code",null,"sendMessage"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": Send a single message to the queue and create a message record to track the message."),s(" : Send a single message to the queue and create a message record to track the message. ")])]),e("li",null,[e("code",null,"sendMessageBatch"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": Send a batch of messages (max 10) to the queue and create a message record to track each message."),s(" : Send a batch of messages (max 10) to the queue and create a message record to track each message. ")])]),e("li",null,[e("code",null,"getMessageRecords"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": Get the message record for a message. Optionally pass consistent read to ensure the message record is not modified by another process."),s(" : Get the message record for a message. Optionally pass consistent read to ensure the message record is not modified by another process. ")])]),e("li",null,[e("code",null,"getMessageRecords"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": Get many message records. Cannot pass consistent read."),s(" : Get many message records. Cannot pass consistent read. ")])]),e("li",null,[e("code",null,"getMessageCluster"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": Get the record for a batch of connected messages (called a message cluster). Optionally pass consistent read to ensure the message record is not modified by another process."),s(" : Get the record for a batch of connected messages (called a message cluster). Optionally pass consistent read to ensure the message record is not modified by another process. ")])]),e("li",null,[e("code",null,"getMessageClusterGlobals"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": Get the global variables for a batch of connected messages (called a message cluster)."),s(" : Get the global variables for a batch of connected messages (called a message cluster). ")])]),e("li",null,[e("code",null,"isComplete"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": Check if a message is complete."),s(" : Check if a message is complete. ")])]),e("li",null,[e("code",null,"markeComplete"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": Mark a message as complete."),s(" : Mark a message as complete. ")])]),e("li",null,[e("code",null,"updateMessageRecord"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": Update a message record."),s(" : Update a message record. ")])]),e("li",null,[e("code",null,"updateMessageCluster"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": Update a message cluter record."),s(" : Update a message cluter record. ")])]),e("li",null,[e("code",null,"updateMessageClusterGlobals"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": Update a message cluster globals."),s(" : Update a message cluster globals. ")])]),e("li",null,[e("code",null,"createMessageCluster"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": Create a message cluster."),s(" : Create a message cluster. ")])])]),e("h2",{id:"flow-of-a-message-cluster",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#flow-of-a-message-cluster","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Flow of a Message Cluster"),s(" Flow of a Message Cluster ")])]),e("ol",null,[e("li",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"From the initial Lambda. Call "),s(" From the initial Lambda. Call ")]),e("code",null,"createMessageCluster"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," to create a message cluster."),s(" to create a message cluster. ")])])]),e("ul",null,[e("li",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Pass the message cluster the following:"),s(" Pass the message cluster the following: ")]),e("ul",null,[e("li",null,[e("code",null,"meta"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": "),s(" : ")]),e("em",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"optional"),s(" optional ")])]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," The meta data for the message cluster. A small piece of data stored in dynamo"),s(" The meta data for the message cluster. A small piece of data stored in dynamo ")])]),e("li",null,[e("code",null,"globals"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": "),s(" : ")]),e("em",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"optional"),s(" optional ")])]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," A large piece of data stored in s3. Can updated at any time"),s(" A large piece of data stored in s3. Can updated at any time ")])]),e("li",null,[e("code",null,"url"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": "),s(" : ")]),e("em",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"required"),s(" required ")])]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," The url of the queue"),s(" The url of the queue ")])]),e("li",null,[e("code",null,"tasks"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": "),s(" : ")]),e("em",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"required"),s(" required ")])]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," Each task is any object that is an explicit set of instructions for a message to perform. This is passed in the body of each message under the key "),s(" Each task is any object that is an explicit set of instructions for a message to perform. This is passed in the body of each message under the key ")]),e("code",null,"task"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," and is stored inside the message record on dynamo, and stored inside each "),s(" and is stored inside the message record on dynamo, and stored inside each ")]),e("code",null,"task"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," of the message cluster record."),s(" of the message cluster record. ")])]),e("li",null,[e("code",null,"<TaskMeta>"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": "),s(" : ")]),e("em",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"typescript"),s(" typescript ")])]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," You can pass in the type of each task."),s(" You can pass in the type of each task. ")])]),e("li",null,[e("code",null,"<Globals>"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": "),s(" : ")]),e("em",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"typescript"),s(" typescript ")])]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," You can pass in the type of your global store."),s(" You can pass in the type of your global store. ")])]),e("li",null,[e("code",null,"<Meta>"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},": "),s(" : ")]),e("em",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"typescript"),s(" typescript ")])]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," You can pass in the type of your meta data."),s(" You can pass in the type of your meta data. ")])])])]),e("li",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"The "),s(" The ")]),e("code",null,"createMessageCluster"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," function then sets up the following for you:"),s(" function then sets up the following for you: ")]),e("ul",null,[e("li",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"It creates a global store in s3 with the name of "),s(" It creates a global store in s3 with the name of ")]),e("code",null,"SQSMESSAGE$<uuid>-globals.json"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},". This is where you can store any data that is needed to be shared between all messages in the cluster."),s(" . This is where you can store any data that is needed to be shared between all messages in the cluster. ")])]),e("li",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"It creates a message cluster record in dynamo with the pKey of "),s(" It creates a message cluster record in dynamo with the pKey of ")]),e("code",null,"SQSMESSAGE$<uuid>"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," and the rKey of "),s(" and the rKey of ")]),e("code",null,"SQSMESSAGE<url>"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},". This keeps track of the messages in the cluster."),s(" . This keeps track of the messages in the cluster. ")])]),e("li",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"It sends of batches of messages to the queue."),s(" It sends of batches of messages to the queue. ")])]),e("li",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"It creates a message record in dynamo for each task (message) in the cluster."),s(" It creates a message record in dynamo for each task (message) in the cluster. ")])])])])]),e("ol",{start:"2"},[e("li",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"From the lambda that gets triggered by the poller poling messages from the queue:"),s(" From the lambda that gets triggered by the poller poling messages from the queue: ")])])]),e("ul",null,[e("li",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"You have to check if the message "),s(" You have to check if the message ")]),e("code",null,"isComplete(record)"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," and if it returns true you can just return null."),s(" and if it returns true you can just return null. ")])]),e("li",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"If the message is not complete, you can begin processing it."),s(" If the message is not complete, you can begin processing it. ")])]),e("li",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"You will probably start by using "),s(" You will probably start by using ")]),e("code",null,"readSQSRecord(record)"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," to get the message record."),s(" to get the message record. ")]),e("ul",null,[e("li",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"It returns to you the following:"),s(" It returns to you the following: ")])])])])]),e("div",{style:{position:"relative"}},[e("pre",{class:"shiki dracula",style:{"background-color":"#282A36",color:"#F8F8F2"}},[e("div",{class:"language-id"},"ts"),e("code",{class:"code-container"},[e("div",{class:"line"},[e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"type"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"Response"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"<"),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"Meta"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"any"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},", "),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"Globals"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"any"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},", "),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"Body"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"any"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"> "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"}," {")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  url"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"string"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  pKey"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"SQSMessageKey"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  rKey"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"SQSMessageKey"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  task"),e("span",{style:{color:"#FF79C6"},class:"[object Object],[object Object]"},"?:"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"string"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  id"),e("span",{style:{color:"#FF79C6"},class:"[object Object],[object Object]"},"?:"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"string"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  body"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"Body"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  type"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"RecordType"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#50FA7B"},class:"[object Object]"},"getMessageCluster"),e("span",{style:{color:"#FF79C6"},class:"[object Object],[object Object]"},"?:"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"}," ("),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"consistentRead"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"boolean"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},") "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"=>"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"Promise"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object]"},"<{ record"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"MessageClusterRecord"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"<"),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"Meta"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"},">, "),e("span",{style:{color:"#50FA7B"},class:"[object Object]"},"getGlobals"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object]"}," () "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"=>"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"Promise"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"<"),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"Globals"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object],[object Object]"},"> }>,")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#50FA7B"},class:"[object Object]"},"getMessageRecord"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"}," ("),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"consistentRead"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"boolean"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},") "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"=>"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"Promise"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"<"),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"MessageRecord"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"<"),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"Meta"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"},">>,")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"}")])])]),e("button",{class:"markdown-it-code-copy","data-clipboard-text":`
	type Response<Meta = any, Globals = any, Body = any> = {
  url: string,
  pKey: SQSMessageKey,
  rKey: SQSMessageKey,
  task?: string,
  id?: string,
  body: Body,
  type: RecordType,
  getMessageCluster?: (consistentRead: boolean) => Promise<{ record: MessageClusterRecord<Meta>, getGlobals: () => Promise<Globals> }>,
  getMessageRecord: (consistentRead: boolean) => Promise<MessageRecord<Meta>>,
}
`,style:{position:"absolute",top:"7.5px",right:"6px",cursor:"pointer",outline:"none"},title:"Copy"},[e("span",{style:{},class:"heroicon heroicon-duplicate"})])]),e("div",{style:{position:"relative"}},[e("pre",null,[e("code",null,"* You get the url, the pKey (if the message is part of a cluster), the rKey (if the message is part of a cluster), the task (if the message is part of a cluster), the id of the message will always be returned. The body of the message will always be returned. And the type of the message will always be returned.\n* You can use the `getMessageRecord` function to get the message record. The use of this would be to gain access to the meta data.\n* You can use the `getMessageCluster` function to get the message cluster record. The use of this would be to gain access to the meta data, or the incomplete tasks, and complete tasks.\n* You can use `getGlobals` to get the global store for this cluster.\n")]),e("button",{class:"markdown-it-code-copy","data-clipboard-text":"\n	* You get the url, the pKey (if the message is part of a cluster), the rKey (if the message is part of a cluster), the task (if the message is part of a cluster), the id of the message will always be returned. The body of the message will always be returned. And the type of the message will always be returned.\n* You can use the `getMessageRecord` function to get the message record. The use of this would be to gain access to the meta data.\n* You can use the `getMessageCluster` function to get the message cluster record. The use of this would be to gain access to the meta data, or the incomplete tasks, and complete tasks.\n* You can use `getGlobals` to get the global store for this cluster.\n",style:{position:"absolute",top:"7.5px",right:"6px",cursor:"pointer",outline:"none"},title:"Copy"},[e("span",{style:{},class:"heroicon heroicon-duplicate"})])]),e("ul",null,[e("li",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"When you are done processing a record call "),s(" When you are done processing a record call ")]),e("code",null,"markComplete(record)"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," to mark the message as complete in both the message record and the message cluster record."),s(" to mark the message as complete in both the message record and the message cluster record. ")])])]),e("h1",{id:"sending-a-simple-message",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#sending-a-simple-message","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Sending a simple message"),s(" Sending a simple message ")])]),e("ol",null,[e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Call "),s(" Call ")]),e("code",null,"sendMessage<Meta>(params: SendMessageRequest, meta?: Meta)"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," which resolves into the "),s(" which resolves into the ")]),e("code",null,"{ pKey: string, rKey: string }"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," of the message record. Before it resolves it sends the message to the queue. Meta is some optional data that is stored on the dynamo record, but not on the message body."),s(" of the message record. Before it resolves it sends the message to the queue. Meta is some optional data that is stored on the dynamo record, but not on the message body. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"When you get the message call "),s(" When you get the message call ")]),e("code",null,"isComplete(record)"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," to check if the message is complete."),s(" to check if the message is complete. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"If the message is not complete you can begin processing it."),s(" If the message is not complete you can begin processing it. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Call "),s(" Call ")]),e("code",null,"readSQSRecord(record)"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," to parse some data from the message, like the body. You can also use the returned "),s(" to parse some data from the message, like the body. You can also use the returned ")]),e("code",null,"getMessageRecord()"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," function to get the message record async."),s(" function to get the message record async. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"When you are done processing a record call "),s(" When you are done processing a record call ")]),e("code",null,"markComplete(record)"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," to mark the message as complete."),s(" to mark the message as complete. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"What happens to the message record? It is deleted immediately."),s(" What happens to the message record? It is deleted immediately. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"What happens if there is an error? It is not deleted and sent back to the queue, if it passes the retry limit it is deleted from the queue, but the message record stays for 30 days."),s(" What happens if there is an error? It is not deleted and sent back to the queue, if it passes the retry limit it is deleted from the queue, but the message record stays for 30 days. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"What if I am allowing for batches of records? You can use the "),s(" What if I am allowing for batches of records? You can use the ")]),e("code",null,"safeProcessBatch(event: SQSEvent, processRecord: (record: SQSRecord) => Promise<void>)"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," function to process a batch of records. In this case the message record is deleted and the message is delted from the queue if it is processed without an error, but if it fails to process it is not deleted from the queue or dynamo and it can be safely reporcessed."),s(" function to process a batch of records. In this case the message record is deleted and the message is delted from the queue if it is processed without an error, but if it fails to process it is not deleted from the queue or dynamo and it can be safely reporcessed. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"You can do the same thing with a batch of messages with "),s(" You can do the same thing with a batch of messages with ")]),e("code",null,"sendMessageBatch<Meta>(params: SendMessageBatchRequest, meta?: Meta)"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},". The meta data in this case is stored on each message record."),s(" . The meta data in this case is stored on each message record. ")])])])]),e("h1",{id:"sending-a-message-cluster",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#sending-a-message-cluster","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Sending a message cluster"),s(" Sending a message cluster ")])]),e("ol",null,[e("li",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Create the cluster:"),s(" Create the cluster: ")])])]),e("div",{style:{position:"relative"}},[e("pre",{class:"shiki dracula",style:{"background-color":"#282A36",color:"#F8F8F2"}},[e("div",{class:"language-id"},"ts"),e("code",{class:"code-container"},[e("div",{class:"line"},[e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"export"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"type"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"MessageClusterParams"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"<"),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"Meta"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"any"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},", "),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"Globals"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"any"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},", "),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"TaskMeta"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"any"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"> "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"}," {")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  url"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"string"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  globals"),e("span",{style:{color:"#FF79C6"},class:"[object Object],[object Object]"},"?:"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"Globals"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  meta"),e("span",{style:{color:"#FF79C6"},class:"[object Object],[object Object]"},"?:"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"Meta"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  tasks"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"TaskMeta"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"[]")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"}")]),e("div",{class:"line"}),e("div",{class:"line"},[e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"export"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"type"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"MessageClusterBody"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"<"),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"TaskMeta"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"any"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"> "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"="),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"}," {")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  pKey"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"SQSMessageKey"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  rKey"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"SQSMessageKey"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  task"),e("span",{style:{color:"#FF79C6"},class:"[object Object],[object Object]"},"?:"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"TaskMeta"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},",")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  type"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"RecordType"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"."),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"task")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"}")]),e("div",{class:"line"}),e("div",{class:"line"},[e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"createMessageCluster"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"<"),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"Meta"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},", "),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"Globals"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},", "),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"TaskMeta"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object]"},">({ ")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object]"},"  url, ")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object],[object Object]"},"  globals, ")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object],[object Object]"},"  meta,")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},"  tasks")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"}"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD","font-style":"italic"},class:"[object Object]"},"MessageClusterParams"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"<"),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"Meta"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},", "),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"Globals"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},", "),e("span",{style:{color:"#FFB86C","font-style":"italic"},class:"[object Object]"},"TaskMeta"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},">)")])])]),e("button",{class:"markdown-it-code-copy","data-clipboard-text":`
	export type MessageClusterParams<Meta = any, Globals = any, TaskMeta = any> = {
  url: string,
  globals?: Globals,
  meta?: Meta,
  tasks: TaskMeta[]
}

export type MessageClusterBody<TaskMeta = any> = {
  pKey: SQSMessageKey,
  rKey: SQSMessageKey,
  task?: TaskMeta,
  type: RecordType.task
}

createMessageCluster<Meta, Globals, TaskMeta>({ 
  url, 
  globals, 
  meta,
  tasks
}: MessageClusterParams<Meta, Globals, TaskMeta>)
`,style:{position:"absolute",top:"7.5px",right:"6px",cursor:"pointer",outline:"none"},title:"Copy"},[e("span",{style:{},class:"heroicon heroicon-duplicate"})])]),e("ol",{start:"2"},[e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"When you recieve the messgae you can process it like other messges:"),s(" When you recieve the messgae you can process it like other messges: ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Call "),s(" Call ")]),e("code",null,"isComplete(record)"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," to check if the message is complete."),s(" to check if the message is complete. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"If the message is not complete you can begin processing it."),s(" If the message is not complete you can begin processing it. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Call "),s(" Call ")]),e("code",null,"readSQSRecord(record)"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," to parse some data from the message, like the body. You can also use the returned "),s(" to parse some data from the message, like the body. You can also use the returned ")]),e("code",null,"getMessageRecord()"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," function to get the message record async. Or you can use the "),s(" function to get the message record async. Or you can use the ")]),e("code",null,"getMessageCluster()"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," function to get the message cluster record async. Or you can use "),s(" function to get the message cluster record async. Or you can use ")]),e("code",null,"getGlobals()"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," to get the global store for this cluster."),s(" to get the global store for this cluster. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"If you need you can update the globals with "),s(" If you need you can update the globals with ")]),e("code",null,"updateGlobals<Globals>(globals: Globals | (globals: Globals) => Globals)"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},". This will update the globals with the new globals."),s(" . This will update the globals with the new globals. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"When you are done processing a record call "),s(" When you are done processing a record call ")]),e("code",null,"markComplete(record)"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," to mark the message as complete. This updates the message cluster as well."),s(" to mark the message as complete. This updates the message cluster as well. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"If you need to run some logic when the cluster is complete you can use "),s(" If you need to run some logic when the cluster is complete you can use ")]),e("code",null,"onClusterComplete(key: { pKey: string, rKey: string }, callback: (cluster: MessageCluster<Meta, TaskMeta>, globals) => Promise<void>)"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," to run the logic when the cluster is complete."),s(" to run the logic when the cluster is complete. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"What happens to the message records? Message records are deleted immediately. The message cluster record is deleted after 30 days."),s(" What happens to the message records? Message records are deleted immediately. The message cluster record is deleted after 30 days. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"What happens to the globals? The globals are avaliable for 30 days."),s(" What happens to the globals? The globals are avaliable for 30 days. ")])])]),e("li",null,[e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"What happens if there is an error in the cluster? The errored message is not deleted and is sent back to the queue to be retried."),s(" What happens if there is an error in the cluster? The errored message is not deleted and is sent back to the queue to be retried. ")])])])])],-1),g={setup(b,{expose:a}){const t={duration:"6 min read",content:`Functions for queue system
sendMessage: Send a single message to the queue and create a message record to track the message.
sendMessageBatch: Send a batch of messages (max 10) to the queue and create a message record to track each message.
getMessageRecords: Get the message record for a message. Optionally pass consistent read to ensure the message record is not modified by another process.
getMessageRecords: Get many message records. Cannot pass consistent read.
getMessageCluster: Get the record for a batch of connected messages (called a message cluster). Optionally pass consistent read to ensure the message record is not modified by another process.
getMessageClusterGlobals: Get the global variables for a batch of connected messages (called a message cluster).
isComplete: Check if a message is complete.
markeComplete: Mark a message as complete.
updateMessageRecord: Update a message record.
updateMessageCluster: Update a message cluter record.
updateMessageClusterGlobals: Update a message cluster globals. 
createMessageCluster: Create a message cluster.

Flow of a Message Cluster
From the initial Lambda. Call createMessageCluster to create a message cluster.
Pass the message cluster the following:meta: optional The meta data for the message cluster. A small piece of data stored in dynamo
globals: optional A large piece of data stored in s3. Can updated at any time
url: required The url of the queue
tasks: required Each task is any object that is an explicit set of instructions for a message to perform. This is passed in the body of each message under the key task and is stored inside the message record on dynamo, and stored inside each task of the message cluster record.
\`\`: typescript You can pass in the type of each task.
\`\`: typescript You can pass in the type of your global store.
\`\`: typescript You can pass in the type of your meta data.


The createMessageCluster function then sets up the following for you:It creates a global store in s3 with the name of SQSMESSAGE$-globals.json. This is where you can store any data that is needed to be shared between all messages in the cluster.
It creates a message cluster record in dynamo with the pKey of SQSMESSAGE$ and the rKey of SQSMESSAGE. This keeps track of the messages in the cluster.
It sends of batches of messages to the queue.
It creates a message record in dynamo for each task (message) in the cluster.




From the lambda that gets triggered by the poller poling messages from the queue:
You have to check if the message isComplete(record) and if it returns true you can just return null.
If the message is not complete, you can begin processing it.
You will probably start by using readSQSRecord(record) to get the message record.It returns to you the following: type Response = {
url: string,
pKey: SQSMessageKey,
rKey: SQSMessageKey,
task?: string,
id?: string,
body: Body,
type: RecordType,
getMessageCluster?: (consistentRead: boolean) =&gt Promise, getGlobals: () =&gt Promise }&gt,
getMessageRecord: (consistentRead: boolean) =&gt Promise&gt,
}

You get the url, the pKey (if the message is part of a cluster), the rKey (if the message is part of a cluster), the task (if the message is part of a cluster), the id of the message will always be returned. The body of the message will always be returned. And the type of the message will always be returned.
You can use the getMessageRecord function to get the message record. The use of this would be to gain access to the meta data.
You can use the getMessageCluster function to get the message cluster record. The use of this would be to gain access to the meta data, or the incomplete tasks, and complete tasks.
You can use getGlobals to get the global store for this cluster.


When you are done processing a record call markComplete(record) to mark the message as complete in both the message record and the message cluster record.



Sending a simple message
Call sendMessage(params: SendMessageRequest, meta?: Meta) which resolves into the { pKey: string, rKey: string } of the message record. Before it resolves it sends the message to the queue. Meta is some optional data that is stored on the dynamo record, but not on the message body.

When you get the message call isComplete(record) to check if the message is complete.

If the message is not complete you can begin processing it.

Call readSQSRecord(record) to parse some data from the message, like the body. You can also use the returned getMessageRecord() function to get the message record async.

When you are done processing a record call markComplete(record) to mark the message as complete.

What happens to the message record? It is deleted immediately.

What happens if there is an error? It is not deleted and sent back to the queue, if it passes the retry limit it is deleted from the queue, but the message record stays for 30 days.

What if I am allowing for batches of records? You can use the safeProcessBatch(event: SQSEvent, processRecord: (record: SQSRecord) =&ampgt; Promise) function to process a batch of records. In this case the message record is deleted and the message is delted from the queue if it is processed without an error, but if it fails to process it is not deleted from the queue or dynamo and it can be safely reporcessed.

You can do the same thing with a batch of messages with sendMessageBatch(params: SendMessageBatchRequest, meta?: Meta). The meta data in this case is stored on each message record.


Sending a message cluster
Create the cluster:export type MessageClusterParams = {
url: string,
globals?: Globals,
meta?: Meta,
tasks: TaskMeta[]
}



export type MessageClusterBody = {
  pKey: SQSMessageKey,
  rKey: SQSMessageKey,
  task?: TaskMeta,
  type: RecordType.task
}
createMessageCluster({ 
  url, 
  globals, 
  meta,
  tasks
}: MessageClusterParams)
\`\`\`
When you recieve the messgae you can process it like other messges:
Call isComplete(record) to check if the message is complete.
If the message is not complete you can begin processing it.
Call readSQSRecord(record) to parse some data from the message, like the body. You can also use the returned getMessageRecord() function to get the message record async. Or you can use the getMessageCluster() function to get the message cluster record async. Or you can use getGlobals() to get the global store for this cluster.
If you need you can update the globals with updateGlobals(globals: Globals | (globals: Globals) =&ampgt; Globals). This will update the globals with the new globals.
When you are done processing a record call markComplete(record) to mark the message as complete. This updates the message cluster as well.
If you need to run some logic when the cluster is complete you can use onClusterComplete(key: { pKey: string, rKey: string }, callback: (cluster: MessageCluster, globals) =&ampgt; Promise) to run the logic when the cluster is complete.


What happens to the message records? Message records are deleted immediately. The message cluster record is deleted after 30 days.

What happens to the globals? The globals are avaliable for 30 days.

What happens if there is an error in the cluster? The errored message is not deleted and is sent back to the queue to be retried.


`,meta:[]};return a({frontmatter:t}),c({meta:[]}),(d,m)=>{const o=l;return n(),r(o,{frontmatter:t},{default:i(()=>[p]),_:1})}}};export{g as default};

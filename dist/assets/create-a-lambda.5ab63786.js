import{_ as a}from"./Post.3c6da465.js";import{q as l,o as n,k as b,w as r,a as e,z as s}from"./vendor.09be1bf3.js";import"./app.3d6c68a9.js";const j=e("div",{class:"prose prose-sm text-left max-w-3xl mx-auto"},[e("h2",{id:"how-to-create-the-lambda-that-will-be-triggered-by-the-sqs-poller",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#how-to-create-the-lambda-that-will-be-triggered-by-the-sqs-poller","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"How to create the lambda that will be triggered by the SQS poller"),s(" How to create the lambda that will be triggered by the SQS poller ")])]),e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Inside of our "),s(" Inside of our ")]),e("code",null,"app"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," we have a directory "),s(" we have a directory ")]),e("code",null,"resources"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," that includes an "),s(" that includes an ")]),e("code",null,"functions.yml"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," file."),s(" file. ")])]),e("div",{style:{position:"relative"}},[e("pre",{class:"shiki dracula",style:{"background-color":"#282A36",color:"#F8F8F2"}},[e("div",{class:"language-id"},"yaml"),e("code",{class:"code-container"},[e("div",{class:"line"},[e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"name"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"${self:service}-${self:provider.stage}-example-queue-lambda")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"description"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"Example of a lambda that can process messages")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"handler"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"src/handler/example.handler")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"memorySize"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"${self:custom.env.LAMBDA_CONFIG.memorySize}")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"timeout"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"${self:custom.env.LAMBDA_CONFIG.timeout}")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"dependsOn"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"mmRole")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"role"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"    "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Fn::GetAtt"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"}," ["),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"mmRole"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},", "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"Arn"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"]")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"environment"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"    "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"region"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"${self:provider.region}")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"    "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"modelmatchTable"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"      "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Fn::ImportValue"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Fn::Sub"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'"),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"${self:custom.env.APP_CONFIG.namespace}-repository-${self:custom.env.APP_CONFIG.environment}-modelmatchTable"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"    "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"queueUrl"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"      "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Ref"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"mmQueue")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"events"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"    "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"sqs"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"batchSize"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#BD93F9"},class:"[object Object]"},"3")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"arn"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"          "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Fn::GetAtt"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"}," ["),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"mmQueue"),e("span",{style:{color:"#F8F8F2"},class:"[object Object],[object Object]"},", "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"Arn"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"]")])])]),e("button",{class:"markdown-it-code-copy","data-clipboard-text":`
	name: \${self:service}-\${self:provider.stage}-example-queue-lambda
  description: Example of a lambda that can process messages
  handler: src/handler/example.handler
  memorySize: \${self:custom.env.LAMBDA_CONFIG.memorySize}
  timeout: \${self:custom.env.LAMBDA_CONFIG.timeout}
  dependsOn: mmRole
  role:
    Fn::GetAtt: [mmRole, Arn]
  environment:
    region: \${self:provider.region}
    modelmatchTable:
      Fn::ImportValue:
        Fn::Sub: <SINGLE-QUOTE>\${self:custom.env.APP_CONFIG.namespace}-repository-\${self:custom.env.APP_CONFIG.environment}-modelmatchTable<SINGLE-QUOTE>
    queueUrl:
      Ref: mmQueue
  events:
    - sqs:
        batchSize: 3
        arn:
          Fn::GetAtt: [mmQueue, Arn]
`,style:{position:"absolute",top:"7.5px",right:"6px",cursor:"pointer",outline:"none"},title:"Copy"},[e("span",{style:{},class:"heroicon heroicon-duplicate"})])]),e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"In general this is the same as any other lambda, but we have added a few extra parameters:"),s(" In general this is the same as any other lambda, but we have added a few extra parameters: ")])]),e("h3",{id:"events--",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#events--","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"events -"),s(" events - ")])]),e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"The events that trigger the lambda, and we want to add a SQS event."),s(" The events that trigger the lambda, and we want to add a SQS event. ")])]),e("h3",{id:"batchsize--",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#batchsize--","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"batchSize -"),s(" batchSize - ")])]),e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"The number of messages to process at a time. If the number of messages in the queue is less than the batch size, then the batch size will be the number of messages in the queue, but it will wait the time specified in the "),s(" The number of messages to process at a time. If the number of messages in the queue is less than the batch size, then the batch size will be the number of messages in the queue, but it will wait the time specified in the ")]),e("code",null,"ReceiveMessageWaitTimeSeconds"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," parameter for messages to arrive."),s(" parameter for messages to arrive. ")])]),e("h2",{id:"important-environment-variables",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#important-environment-variables","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Important environment variables"),s(" Important environment variables ")])]),e("ol",null,[e("li",null,[e("code",null,"modelmatchTable"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," \u2014 We need this to work with the MM Messaging API."),s(" \u2014 We need this to work with the MM Messaging API. ")])]),e("li",null,[e("code",null,"queueUrl"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"}," \u2014 We need this to work with the SQS API."),s(" \u2014 We need this to work with the SQS API. ")])])]),e("h2",{id:"important-permissions",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#important-permissions","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Important permissions"),s(" Important permissions ")])]),e("p",null,[e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"Whatever role you are depending on, it needs to have the following permissions:"),s(" Whatever role you are depending on, it needs to have the following permissions: ")])]),e("h3",{id:"the-sqs-policy",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#the-sqs-policy","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"The SQS Policy"),s(" The SQS Policy ")])]),e("div",{style:{position:"relative"}},[e("pre",{class:"shiki dracula",style:{"background-color":"#282A36",color:"#F8F8F2"}},[e("div",{class:"language-id"},"yaml"),e("code",{class:"code-container"},[e("div",{class:"line"},[e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"PolicyDocument"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Version"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'"),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"2012-10-17"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Statement"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"    "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Effect"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"Allow")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"      "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Action"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"sqs:GetQueueAttributes")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"sqs:GetQueueUrl")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"sqs:SendMessage")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"sqs:SendMessageBatch")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"sqs:DeleteMessage")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"sqs:DeleteMessageBatch")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"sqs:ReceiveMessage")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"      "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Resource"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Fn::Sub"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'"),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"arn:aws:sqs:${AWS::Region}:${AWS::AccountId}:${self:service}-${self:provider.stage}-${self:custom.env.SQS.queueName}"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'")])])]),e("button",{class:"markdown-it-code-copy","data-clipboard-text":`
	PolicyDocument:
  Version: <SINGLE-QUOTE>2012-10-17<SINGLE-QUOTE>
  Statement:
    - Effect: Allow
      Action:
        - sqs:GetQueueAttributes
        - sqs:GetQueueUrl
        - sqs:SendMessage
        - sqs:SendMessageBatch
        - sqs:DeleteMessage
        - sqs:DeleteMessageBatch
        - sqs:ReceiveMessage
      Resource:
        - Fn::Sub: <SINGLE-QUOTE>arn:aws:sqs:\${AWS::Region}:\${AWS::AccountId}:\${self:service}-\${self:provider.stage}-\${self:custom.env.SQS.queueName}<SINGLE-QUOTE>
`,style:{position:"absolute",top:"7.5px",right:"6px",cursor:"pointer",outline:"none"},title:"Copy"},[e("span",{style:{},class:"heroicon heroicon-duplicate"})])]),e("h3",{id:"the-dynamodb-policy",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#the-dynamodb-policy","aria-hidden":"true"},"#"),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"})]),e("span",{class:"emoji-wrapper"},[e("span",{class:"native-emoji"},"The DynamoDB Policy"),s(" The DynamoDB Policy ")])]),e("div",{style:{position:"relative"}},[e("pre",{class:"shiki dracula",style:{"background-color":"#282A36",color:"#F8F8F2"}},[e("div",{class:"language-id"},"yaml"),e("code",{class:"code-container"},[e("div",{class:"line"},[e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"PolicyDocument"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Version"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'"),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"2012-10-17"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"  "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Statement"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"    "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Effect"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"Allow")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"      "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Action"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"dynamodb:BatchGetItem")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"dynamodb:BatchWriteItem")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"dynamodb:GetItem")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"dynamodb:PutItem")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"dynamodb:DeleteItem")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"dynamodb:Query")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"dynamodb:Scan")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"dynamodb:UpdateItem")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"dynamodb:DescribeStream")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"dynamodb:GetRecords")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"dynamodb:GetShardIterator")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#F1FA8C"},class:"[object Object],[object Object]"},"dynamodb:ListStreams")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"      "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Resource"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Fn::Sub"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'"),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${self:custom.env.APP_CONFIG.namespace}-repository-${self:custom.env.APP_CONFIG.environment}-modelmatchTable"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Fn::Sub"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'"),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${self:custom.env.APP_CONFIG.namespace}-repository-${self:custom.env.APP_CONFIG.environment}-modelmatchTable/index/*"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'")]),e("div",{class:"line"},[e("span",{style:{color:"#F8F8F2"},class:"[object Object]"},"        "),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},"-"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#8BE9FD"},class:"[object Object],[object Object]"},"Fn::Sub"),e("span",{style:{color:"#FF79C6"},class:"[object Object]"},":"),e("span",{style:{color:"#F8F8F2"},class:"[object Object]"}," "),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'"),e("span",{style:{color:"#F1FA8C"},class:"[object Object]"},"arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${self:custom.env.APP_CONFIG.namespace}-repository-${self:custom.env.APP_CONFIG.environment}-modelmatchTable/stream/*"),e("span",{style:{color:"#E9F284"},class:"[object Object]"},"'")])])]),e("button",{class:"markdown-it-code-copy","data-clipboard-text":`
	PolicyDocument:
  Version: <SINGLE-QUOTE>2012-10-17<SINGLE-QUOTE>
  Statement:
    - Effect: Allow
      Action:
        - dynamodb:BatchGetItem
        - dynamodb:BatchWriteItem
        - dynamodb:GetItem
        - dynamodb:PutItem
        - dynamodb:DeleteItem
        - dynamodb:Query
        - dynamodb:Scan
        - dynamodb:UpdateItem
        - dynamodb:DescribeStream
        - dynamodb:GetRecords
        - dynamodb:GetShardIterator
        - dynamodb:ListStreams
      Resource:
        - Fn::Sub: <SINGLE-QUOTE>arn:aws:dynamodb:\${AWS::Region}:\${AWS::AccountId}:table/\${self:custom.env.APP_CONFIG.namespace}-repository-\${self:custom.env.APP_CONFIG.environment}-modelmatchTable<SINGLE-QUOTE>
        - Fn::Sub: <SINGLE-QUOTE>arn:aws:dynamodb:\${AWS::Region}:\${AWS::AccountId}:table/\${self:custom.env.APP_CONFIG.namespace}-repository-\${self:custom.env.APP_CONFIG.environment}-modelmatchTable/index/*<SINGLE-QUOTE>
        - Fn::Sub: <SINGLE-QUOTE>arn:aws:dynamodb:\${AWS::Region}:\${AWS::AccountId}:table/\${self:custom.env.APP_CONFIG.namespace}-repository-\${self:custom.env.APP_CONFIG.environment}-modelmatchTable/stream/*<SINGLE-QUOTE>
`,style:{position:"absolute",top:"7.5px",right:"6px",cursor:"pointer",outline:"none"},title:"Copy"},[e("span",{style:{},class:"heroicon heroicon-duplicate"})])])],-1),u={setup(F,{expose:c}){const t={title:"Create a Lambda",duration:"3 min read",content:`How to create the lambda that will be triggered by the SQS poller
Inside of our app we have a directory resources that includes an functions.yml file.
name: \${self:service}-\${self:provider.stage}-example-queue-lambda
  description: Example of a lambda that can process messages
  handler: src/handler/example.handler
  memorySize: \${self:custom.env.LAMBDA_CONFIG.memorySize}
  timeout: \${self:custom.env.LAMBDA_CONFIG.timeout}
  dependsOn: mmRole
  role:
    Fn::GetAtt: [mmRole, Arn]
  environment:
    region: \${self:provider.region}
    modelmatchTable:
      Fn::ImportValue:
        Fn::Sub: &#39\${self:custom.env.APP_CONFIG.namespace}-repository-\${self:custom.env.APP_CONFIG.environment}-modelmatchTable&#39
    queueUrl:
      Ref: mmQueue
  events:
    - sqs:
        batchSize: 3
        arn:
          Fn::GetAtt: [mmQueue, Arn]
In general this is the same as any other lambda, but we have added a few extra parameters:
events -
The events that trigger the lambda, and we want to add a SQS event.
batchSize -
The number of messages to process at a time. If the number of messages in the queue is less than the batch size, then the batch size will be the number of messages in the queue, but it will wait the time specified in the ReceiveMessageWaitTimeSeconds parameter for messages to arrive.
Important environment variables
modelmatchTable \u2014 We need this to work with the MM Messaging API.
queueUrl \u2014 We need this to work with the SQS API.

Important permissions
Whatever role you are depending on, it needs to have the following permissions:
The SQS Policy
PolicyDocument:
  Version: &#392012-10-17&#39
  Statement:
    - Effect: Allow
      Action:
        - sqs:GetQueueAttributes
        - sqs:GetQueueUrl
        - sqs:SendMessage
        - sqs:SendMessageBatch
        - sqs:DeleteMessage
        - sqs:DeleteMessageBatch
        - sqs:ReceiveMessage
      Resource:
        - Fn::Sub: &#39arn:aws:sqs:\${AWS::Region}:\${AWS::AccountId}:\${self:service}-\${self:provider.stage}-\${self:custom.env.SQS.queueName}&#39
The DynamoDB Policy
PolicyDocument:
  Version: &#392012-10-17&#39
  Statement:
    - Effect: Allow
      Action:
        - dynamodb:BatchGetItem
        - dynamodb:BatchWriteItem
        - dynamodb:GetItem
        - dynamodb:PutItem
        - dynamodb:DeleteItem
        - dynamodb:Query
        - dynamodb:Scan
        - dynamodb:UpdateItem
        - dynamodb:DescribeStream
        - dynamodb:GetRecords
        - dynamodb:GetShardIterator
        - dynamodb:ListStreams
      Resource:
        - Fn::Sub: &#39arn:aws:dynamodb:\${AWS::Region}:\${AWS::AccountId}:table/\${self:custom.env.APP_CONFIG.namespace}-repository-\${self:custom.env.APP_CONFIG.environment}-modelmatchTable&#39
        - Fn::Sub: &#39arn:aws:dynamodb:\${AWS::Region}:\${AWS::AccountId}:table/\${self:custom.env.APP_CONFIG.namespace}-repository-\${self:custom.env.APP_CONFIG.environment}-modelmatchTable/index/*&#39
        - Fn::Sub: &#39arn:aws:dynamodb:\${AWS::Region}:\${AWS::AccountId}:table/\${self:custom.env.APP_CONFIG.namespace}-repository-\${self:custom.env.APP_CONFIG.environment}-modelmatchTable/stream/*&#39
`,meta:[{property:"og:title",content:"Create a Lambda"}]};return c({frontmatter:t}),l({title:"Create a Lambda",meta:[{property:"og:title",content:"Create a Lambda"}]}),(p,m)=>{const o=a;return n(),b(o,{frontmatter:t},{default:r(()=>[j]),_:1})}}};export{u as default};
